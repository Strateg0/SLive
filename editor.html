<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="–ê–≥–µ–Ω—Ü–∏—è—Ç–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è —à–∏—Ä–æ–∫ —Å–ø–µ–∫—Ç—ä—Ä –æ—Ç —É—Å–ª—É–≥–∏ –Ω–∞ –ø—É–±–ª–∏—á–Ω–∏—è –∏ —á–∞—Å—Ç–Ω–∏—è —Å–µ–∫—Ç–æ—Ä –≤ –ë—ä–ª–≥–∞—Ä–∏—è –∏ –≤ —á—É–∂–±–∏–Ω–∞. –¢—è —Ä–∞–∑–ø–æ–ª–∞–≥–∞ —Å –µ–∫–∏–ø –æ—Ç –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–∏ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–∏—Å—Ç–∏ —Å –æ–±—à–∏—Ä–Ω–∏ –∑–Ω–∞–Ω–∏—è –∏ –æ–ø–∏—Ç –≤ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ—Ç–æ –Ω–∞ –º–∞—â–∞–±–Ω–∏ –ø—Ä–æ–µ–∫—Ç–∏ –∑–∞ —Ä–∞–∑–≤–∏—Ç–∏–µ –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤ —Å–ª–µ–¥–Ω–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–∏ –æ–±–ª–∞—Å—Ç–∏: –º–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è –Ω–∞ –ø—É–±–ª–∏—á–Ω–∞—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ—Ç–æ –Ω–∞ –ø—É–±–ª–∏—á–Ω–∏—è —Å–µ–∫—Ç–æ—Ä, –∏–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ –ø–ª–∞–Ω–∏—Ä–∞–Ω–µ, –ø—É–±–ª–∏—á–Ω–∏ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏–∏ –∏ –º–µ–¥–∏–∏, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, —á–æ–≤–µ—à–∫–∏ —Ä–µ—Å—É—Ä—Å–∏ –∏ –æ–±—É—á–µ–Ω–∏–µ.">
	<meta name="keywords" content="HTML,CSS,XML,JavaScript">
	<meta name="author" content="STRATEGMA AGENCY">
	<title>STRATEGMA | Archive</title>
  <link rel="icon" type="image/x-icon" href="./img/favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" integrity="sha384-tViUnnbYAV00FLIhhi3v/dWt3Jxw4gZQcNoSCxCIFNJVCx7/D55/wXsrNIRANwdD" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.3.2/css/flag-icons.min.css" />
   <!--== Custom style -->
  <link href="./style.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    html, body {
      overflow-x: hidden;
      width: 100%;
      max-width: 100%;
    }
    
    #editor-container {
      height: 500px;
      width: 100%;
    }
    .input-group {
      margin-bottom: 15px;
    }
    label {
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    .input-error {
    border: 2px solid red !important;
    outline: none;
    background-color: #ffe6e6;
  }

  select.input-error {
    border: 2px solid red !important;
    background-color: #ffe6e6;
  }
  </style>
  </head>
<body>
<main>
<div class="container-fluid px-0">
<nav class="navbar navbar-expand-lg navbar-light sticky-top border-bottom mb-0">
  <div class="container-fluid">
    <a href="index.html" class="navbar-brand d-flex align-items-center">
      <span class="fs-4"><img src="./img/logo.png" id="logo" class="dark-logo" style="width: 100px;"></span>
      <!-- <span class="fs-4"><img src="./img/logo-light.png" class="light-logo" style="width: 180px;"></span> -->
    </a>
    <!-- button for Mobile dark/light mode-->
   <button id="themeToggle" class="theme-toggle ms-5 d-block d-sm-none d-md-block d-lg-none d-xl-none" aria-label="Toggle theme"><span class="icon">üåô</span></button>
       <!-- Hamburger button for mobile not active-->
    <button class="navbar-toggler d-block ms-0 d-sm-block d-md-block d-lg-none d-xl-none" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar" aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <!-- dropdown selection menu Mobile -->
     <div class="dropdown d-none d-sm-none d-md-none d-lg-none d-xl-none">
        <a class="btn dropdown-toggle mb-0 mb-lg-0" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
          <span class="fi fi-gb"></span>
        </a>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
          <li><a class="dropdown-item lang-option" href="#"> <span class="fi fi-gb"></span> English</a></li>
          <li><a class="dropdown-item lang-option" href="#"><span class="fi fi-es"></span> Spanish</a></li>
          <li><a class="dropdown-item lang-option" href="#"><span class="fi fi-fr"></span> French</a></li>
          <li><a class="dropdown-item lang-option" href="#"><span class="fi fi-hr"></span> Croatian</a></li>
        </ul>
      </div>
    <!-- Collapsible menu items -->
    <div class="collapse navbar-collapse pt-4 pt-lg-0" id="mainNavbar">
      <ul class="navbar-nav ms-auto mb-2 mb-md-0 mb-lg-0">
        <li class="nav-item"><a href="index.html" class="nav-link" data-i18n="home">–ù–∞—á–∞–ª–æ</a></li>
        <li class="nav-item"><a href="sectors.html" class="nav-link" data-i18n="sector">—Å–µ–∫—Ç–æ—Ä–∏</a></li>
        <li class="nav-item"><a href="offer.html" class="nav-link" data-i18n="whatweoffer">–∫–∞–∫–≤–æ –ø—Ä–µ–¥–ª–∞–≥–∞–º–µ</a></li>
        <li class="nav-item"><a href="new.html" class="nav-link" data-i18n="novelties">–Ω–æ–≤–æ—Å—Ç–∏</a></li>
        <li class="nav-item"><a href="aboutUs.html" class="nav-link" data-i18n="aboutush">–∑–∞ –Ω–∞—Å</a></li>
        <li class="nav-item"><a href="blog.html" class="nav-link" data-i18n="blog">–±–ª–æ–≥</a></li>
        <div class="dropdown px-3">
          <a class="btn dropdown-toggle mb-2 mb-lg-0" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
           <span class="fi fi-gb"></span>
          </a>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
            <li><a class="dropdown-item lang-option" data-lang="en" href="#"> <span class="fi fi-gb"></span> English</a></li>
            <li><a class="dropdown-item lang-option" data-lang="es"href="#"><span class="fi fi-es"></span> Spanish</a></li>
            <li><a class="dropdown-item lang-option" data-lang="fr"href="#"><span class="fi fi-fr"></span> French</a></li>
            <li><a class="dropdown-item lang-option" data-lang="hr" href="#"><span class="fi fi-hr"></span> Croatian</a></li>
          </ul>
        </div>
        <button id="themeToggleDesk" class="theme-toggle ms-1 d-none d-sm-none d-md-none d-lg-block d-xl-block" aria-label="Toggle theme"><span class="icon">üåô</span></button>
<!--CLEAR OUT -->
      </ul>
    </div>
  </div>
</nav>

<body>
<section class="px-0 py-0 py-lg-5 text-center">
   <div class="container px-3 py-5">
       <div class="row">
        <div class="col-md-12 justify-content-center align-self-center">
  <h2>Edit Your Blog Post</h2>
  <div class="input-group">
    <label for="topic">Topic</label>
    <select id="topic">
       <option value="0">Choose Topic</option>
      <option value="Market Tips">Market Tips</option>
            <option value="Tech">Tech</option>
            <option value="Lifestyle">Lifestyle</option>
            <option value="Market Tips">Market Tips</option>
            <option value="Crypto">Crypto</option>
            <option value="Innovations">Innovations</option>
            <option value="Interactive Map">Interactive Map</option>
    </select>
  </div>

  <div class="input-group">
    <label for="author">Author</label>
    <select id="author">
       <option value="John Michele">John Michele</option>
            <option value="Sarah Lin">Sarah Lin</option>
            <option value="David Ko">David Ko</option>
            <option value="Emma Zhou">Emma Zhou</option>
            <option value="John Michele">John Michele</option>
            <option value="Anna Smith">Anna Smith</option>
            <option value="Dimitar Ivanov">Dimitar Ivanov</option>
            <option value="Rosen Pavlov">Rosen Pavlov</option>
             <option value="Tihomira Trifonova">Tihomira Trifonova</option>
    </select>
  </div>

  <div class="input-group">
    <label for="category">Category:</label>
    <select id="category">
      <option value="0">Choose Category</option>
      <option value="blog">Blog</option>
      <option value="news">News</option>
    </select>
  </div>

  <div class="input-group">
    <label for="title">Title</label>
    <input type="text" id="title" rows="1" cols="10" placeholder="Enter Title..." />
    <p id="titleWordCount">Words: 0 / 15</p>
  </div>

  <div class="input-group">
    <label for="description">Short Description</label>
    <textarea id="description" rows="1" cols="10" placeholder="Enter Description..."></textarea>
    <p id="descriptionWordCount">Words: 0 / 15</p>
  </div>

  <div class="input-group">
    <label for="imageUrl">Image URL</label>
    <input type="text" id="imageUrl" placeholder="This Field will not be visible if applying URLs!"/>
  </div>

<div class="input-group">
  <label for="iframeInput">Embed iFrame (YouTube, Map, URLs, etc.)</label>
  <input id="iframeInput" type="text" placeholder="Paste iframe URL here (e.g. https://www.youtube.com/embed/VIDEO_ID)"/>
    <div class="edtr d-inline-flex">
  <button type="button" onclick="insertIframe()">Insert Iframe</button>
  <button type="button" onclick="removeIframes()">Remove All Iframes</button>
  </div>
</div>

  <div class="input-group">
    <!-- <label>Article Content</label> -->
    <div id="editor-container"></div>
  </div>
  <div class="edtr d-inline-flex">
    <button id="saveBtn" onclick="saveDraft()">–ó–∞–ø–∞–∑–∏ –ö–∞—Ç–æ –î—Ä–∞—Ñ—Ç</button>
    <button class="creation" onclick="goToArchive()">–û—Ç–∫–∞–∑ <i class="bi bi-x-circle-fill"></i></button>
  </div>
</div>
</div>
</div>
</section>



<footer id="footer" class="footer mt-auto py-3">
  <div class="container-fluid">
    <div class="container py-lg-4">
      <div class="row">
        <div class="col-lg-7 col-md-7 col-sm-7 mt-sm-0 mt-3 mt-lg-5">
          <ul class="footer-list">
            <h1 class="footer-title">–ö–æ–Ω—Ç–∞–∫—Ç–∏</h1>
            <li><a href="about.html"><i class="bi bi-geo-alt-fill"></i> –≥—Ä. –°–æ—Ñ–∏—è 1202, —É–ª. ‚Äû–ì. –†–∞–∫–æ–≤—Å–∫–∏‚Äù ‚Ññ 18, –µ—Ç. 4</a></li>
            <li><a href="blog.html"><i class="bi bi-telephone-fill"></i> (+359 2) 981 47 38</a></li>
            <li><a href="#pricing"><i class="bi bi-envelope-check-fill"></i> agency@strategma.bg</a></li>
          </ul>
          <ul>
            <h1 class="footer-title">–ü–æ—Å–ª–µ–¥–≤–∞–π –Ω–∏</h1>
            <div class="social-icons-main mt-4 pb-3 FooterSocial">
                <ul class="social-icons3 px-0 mx-auto">
                  <li>
                        <a href="">
                           <i class="bi bi-facebook"></i>
                        </a>
                    </li>
                    <li>
                        <a href="">
                            <i class="bi bi-linkedin"></i>

                        </a>
                    </li>
                   <li>
                        <a href="">
                            <i class="bi bi-youtube"></i>
                        </a>
                    </li>
                </ul>
            </div>
          </ul>
        </div>
        <div class="col-lg-5 col-md-5 col-sm-5 footer-list-29 footer-3 mt-lg-0 mt-3 pt-lg-2">
          <div class="img_storege">
            <img src="./img/logos.png">
            <img src="./img/logo_rina.jpg" class="pt-4" style="width:250px;height: 184px;">
            <p class="pt-4">–ê–≥–µ–Ω—Ü–∏—è –°–¢–†–ê–¢–ï–ì–ú–ê –ø–æ–¥–¥—ä—Ä–∂–∞ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ—Ç–æ,
            —Å–∏–≥—É—Ä–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è—Ç–∞ –∏ –æ–∫–æ–ª–Ω–∞—Ç–∞ —Å—Ä–µ–¥–∞ —Å—ä–≥–ª–∞—Å–Ω–æ <a href="docs/STR-9001-BG-EN.pdf" target="_blank"><strong>ISO 9001:2015/ </strong></a> 
            <a href="docs/STR-14001-BG-EN.pdf" target="_blank"><strong>ISO 14001:2015/ </strong></a> 
            <a href="docs/STR-27001-BG.pdf" target="_blank"><strong>ISO 27001:2013.</strong></a></p>
            <p class="pt-4"> <a href="docs/20171123_strategma_QP.pdf" target="_blank"><strong>–ü–æ–ª–∏—Ç–∏–∫–∞ –ø–æ –∫–∞—á–µ—Å—Ç–≤–æ—Ç–æ, —Å–∏–≥—É—Ä–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è—Ç–∞ –∏ –æ–∫–æ–ª–Ω–∞—Ç–∞ —Å—Ä–µ–¥–∞.</strong></a></p>
            <p class="pt-4"></p>
          </div>
        </div>
      </div>
    </div>
    <!-- Back to top button -->
    <a id="btnTop"><i class="bi bi-chevron-up"></i></a>
    <div class="container-fluid footer_copyright">
      <div class="container">
        <div class="row justify-content-md-center">
          <div class="col col-lg-8 px-0">
          <p class="text-left text-aligne-left pt-4">–í—Å–∏—á–∫–∏ –ø—Ä–∞–≤–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ &copy; STRATEGMA.BG 2025</p>
          </div>
          <div class="col-md-auto">
           <a href="#"><p class="text-right text-aligne-right pt-4">Privacy Policy</p></a>
          </div>
          <div class="col col-lg-2">
          <a href="#"><p class="text-right text-aligne-right pt-4">Terms & Conditions</p></a>
          </div>
          <!-- More if needed -->
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="./js/active.js"></script>
<script src="./js/mode.js"></script>
<script src="./js/archive.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
  $(document).ready(function () {
    $(window).on('scroll', function () {
      if ($(this).scrollTop() > 250) {
        $('nav').addClass('sticky-nav').css('top', '0');
      } else {
        $('nav').removeClass('sticky-nav').css('top', '-100px');
      }
    });
  });
</script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const btn = document.getElementById('btnTop');

  window.addEventListener('scroll', function () {
    if (window.scrollY > 500) {
      btn.classList.add('show');
    } else {
      btn.classList.remove('show');
    }
  });

  btn.addEventListener('click', function (e) {
    e.preventDefault();
   window.scrollTo({ top: 0, behavior: 'smooth' });
  });
});
</script>

<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script>
      // Init Quill editor
      const quill = new Quill('#editor-container', {
        theme: 'snow',
        placeholder: 'Write your article content here even after adding a URls under it and don`t forget to give it a style HEADING...',
        modules: {
          toolbar: [
      [{ font: [] }, { size: ['small', false, 'large', 'huge'] }],
      [{ header: [1, 2, 3, false] }],
      ['bold', 'italic', 'underline', 'strike'],
      [{ color: [] }, { background: [] }],
      [{ align: [] }],
      [{ list: 'ordered' }, { list: 'bullet' }],
      ['link', 'image', 'clean']
    ]
    }
  });

  let editingId = null; // Holds Firestore doc ID if editing

  window.onload = function () {
    const urlParams = new URLSearchParams(window.location.search);
    const isEditing = urlParams.get('edit') === 'true';

    const draftKey = isEditing ? 'editDraft' : 'draftPost';
    const draft = JSON.parse(sessionStorage.getItem(draftKey));

    if (draft) {
      document.getElementById('topic').value = draft.topic || '';
      document.getElementById('author').value = draft.author || '';
      document.getElementById('title').value = draft.title || '';
      document.getElementById('description').value = draft.description || '';
      document.getElementById('imageUrl').value = draft.imageUrl || '';
      document.getElementById('iframeInput').value = draft.iframeInput || '';
      
      if (draft.content) {
        quill.root.innerHTML = draft.content;
      }

      // ‚úÖ Load category into dropdown
      if (draft.category) {
        document.getElementById('category').value = draft.category;
      }

      if (isEditing && draft.id) {
        editingId = draft.id;
        document.getElementById('saveBtn').textContent = 'Update Draft';
      }
    }
  };

  async function saveDraft() {
    const { collection, addDoc, doc, updateDoc } = window.firebaseRefs;
    const db = window.firebaseDB;

    const post = {
      topic: document.getElementById('topic').value,
      author: document.getElementById('author').value,
      title: document.getElementById('title').value,
      description: document.getElementById('description').value,
      imageUrl: document.getElementById('imageUrl').value,
      iframeInput: document.getElementById('iframeInput').value,
      content: quill.root.innerHTML,
      date: new Date().toLocaleDateString(),
      createdAt: Date.now(),
      published: false,
      category: document.getElementById('category').value || 'blog' // fallback
    };

function showWarning(message) {
  let warning = document.getElementById('warning-message');
  if (!warning) {
    warning = document.createElement('div');
    warning.id = 'warning-message';
    warning.style.color = 'red';
    warning.style.marginTop = '10px';
    warning.style.fontWeight = 'bold';
    warning.style.background = '#ffe6e6';
    warning.style.padding = '10px';
    warning.style.borderRadius = '5px';
    document.getElementById('editor-container').parentNode.insertBefore(warning, document.getElementById('editor-container'));
  }
  warning.textContent = message;
}

function showSuccess(message) {
  alert(message);
  const warning = document.getElementById('warning-message');
  if (warning) warning.remove();
}

// ‚úÖ Required Fields Validation (works for <input> and <select>)
const requiredFields = [
  { id: 'title', label: 'Title' },
  { id: 'description', label: 'Description' },
  { id: 'topic', label: 'Topic' },
  { id: 'author', label: 'Author' },
  { id: 'category', label: 'Category' }
];

// Clear previous errors
requiredFields.forEach(field => {
  document.getElementById(field.id).classList.remove('input-error');
});
document.getElementById('editor-container').classList.remove('input-error');

// Find missing fields
const missingFields = requiredFields.filter(({ id }) => {
  const el = document.getElementById(id);
  if (!el) return true; // Defensive fallback

  const value = el.value.trim();

  // For SELECT, check if first option (placeholder) is selected
  if (el.tagName === 'SELECT') {
    return value === '' || el.selectedIndex === 0;
  }

  return value === '';
});


// Validate Quill content
const tempDiv = document.createElement('div');
tempDiv.innerHTML = post.content;
const plainText = tempDiv.textContent.trim();

if (missingFields.length || !plainText) {
  // Highlight missing inputs/selects
  missingFields.forEach(field => {
    const el = document.getElementById(field.id);
    if (el) el.classList.add('input-error');
  });

  if (!plainText) {
    document.getElementById('editor-container').classList.add('input-error');
  }

  // Show warning message
  const fieldNames = missingFields.map(f => f.label);
  if (!plainText) fieldNames.push('Content');

  const message = `Please fill in the following required fields: ${fieldNames.join(', ')}.`;
  showWarning(message);
  return;
}

    try {
      if (editingId) {
        const docRef = doc(db, "posts", editingId);
        await updateDoc(docRef, post);
        alert("Draft updated!");
      } else {
        await addDoc(collection(db, "posts"), post);
        alert("Draft saved!");
      }

      sessionStorage.removeItem('editDraft');
      sessionStorage.removeItem('draftPost');
      window.location.href = "archive.html";
    } catch (e) {
      alert("Error saving draft: " + e.message);
    }
  }
</script>

<script>
function setupWordLimit(fieldId, countId, maxWords) {
    const field = document.getElementById(fieldId);
    const wordCountDisplay = document.getElementById(countId);

    field.addEventListener('input', () => {
      let words = field.value.trim().split(/\s+/).filter(w => w.length > 0);

      if (words.length > maxWords) {
        field.value = words.slice(0, maxWords).join(' ');
        words = words.slice(0, maxWords);
      }

      wordCountDisplay.textContent = `Words: ${words.length} / ${maxWords}`;
    });
  }

  // Setup limits for each field:
  setupWordLimit('title', 'titleWordCount', 15);
  setupWordLimit('description', 'descriptionWordCount', 15);
</script>


<script>
  // Register iframe blot for Quill to allow iframe embeds
  const BlockEmbed = Quill.import('blots/block/embed');

  class IframeBlot extends BlockEmbed {
    static create(value) {
      const node = super.create();
      node.setAttribute('src', value.src);
      node.setAttribute('width', value.width || '100%');
      node.setAttribute('height', value.height || '400');
      node.setAttribute('frameborder', '0');
      node.setAttribute('allowfullscreen', true);
      return node;
    }

    static value(node) {
      return {
        src: node.getAttribute('src'),
        width: node.getAttribute('width'),
        height: node.getAttribute('height')
      };
    }
  }

  IframeBlot.blotName = 'iframe';
  IframeBlot.tagName = 'iframe';
  IframeBlot.className = 'custom-iframe';

  Quill.register(IframeBlot);
</script>

<script>
// function insertIframe() {
//   const urlInput = document.getElementById('iframeInput');
//   if (!urlInput) {
//     alert('Iframe URL input field not found!');
//     return;
//   }

//   const url = urlInput.value.trim();
//   if (!url.startsWith('http')) {
//     alert('Please enter a valid iframe URL starting with http or https.');
//     return;
//   }

//   const width = prompt('Enter iframe width (e.g. 100% or 1200)', '100%') || '100%';
//   const height = prompt('Enter iframe height in px (e.g. 400)', '400') || '400';

//   const range = quill.getSelection(true);
//   if (range) {
//     quill.insertEmbed(range.index, 'iframe', { src: url, width, height }, Quill.sources.USER);
//     quill.setSelection(range.index + 1, Quill.sources.SILENT); // Move cursor after iframe
//     urlInput.value = ''; // Clear input
//   } else {
//     alert('Place your cursor in the editor where you want to insert the iframe.');
//   }
// }
function insertIframe() {
  const urlInput = document.getElementById('iframeInput');
  if (!urlInput) {
    alert('Iframe URL input field not found!');
    return;
  }

  let url = urlInput.value.trim();
  if (!url.startsWith('http')) {
    alert('Please enter a valid iframe URL starting with http or https.');
    return;
  }

  url = convertToEmbedUrl(url); // ‚úÖ Convert YouTube URL to embed if needed

  const width = prompt('Enter iframe width (e.g. 100% or 1200)', '100%') || '100%';
  const height = prompt('Enter iframe height in px (e.g. 400)', '400') || '400';

  const range = quill.getSelection(true);
  if (range) {
    quill.insertEmbed(range.index, 'iframe', { src: url, width, height }, Quill.sources.USER);
    quill.setSelection(range.index + 1, Quill.sources.SILENT);
    urlInput.value = '';
  } else {
    alert('Place your cursor in the editor where you want to insert the iframe.');
  }
}

function removeIframes() {
  const delta = quill.getContents();
  const newDelta = delta.ops.filter(op => {
    return !(op.insert && op.insert.iframe);
  });

  quill.setContents({ ops: newDelta });
}
</script>

<script>
  const iframeInput = document.getElementById('iframeInput');
  const imageUrlInput = document.getElementById('imageUrl');
  const descriptionInput = document.getElementById('description');
  const imageUrlContainer = imageUrlInput.closest('.input-group'); // assuming wrapped in form-group div
  const descriptionContainer = descriptionInput.closest('.input-group');

  iframeInput.addEventListener('input', () => {
    const value = iframeInput.value.trim();
    const isIframeUrl = value.startsWith('http') && value.includes('iframe') || value.includes('youtube.com/embed');

    if (isIframeUrl) {
      // Hide & disable image and description
      if (imageUrlContainer) imageUrlContainer.style.display = 'none';
      if (descriptionContainer) descriptionContainer.style.display = 'none';

      imageUrlInput.value = '';
      descriptionInput.value = '';
    } else {
      // Show image and description fields
      if (imageUrlContainer) imageUrlContainer.style.display = '';
      if (descriptionContainer) descriptionContainer.style.display = '';
    }
  });

  function convertToEmbedUrl(url) {
  // If it's a regular YouTube watch URL, convert it to embed format
  const youtubeRegex = /(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([\w-]+)/;
  const match = url.match(youtubeRegex);
  if (match && match[1]) {
    return `https://www.youtube.com/embed/${match[1]}`;
  }

  // If it's already an embed URL or something else, return as is
  return url;
}

</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";
  // import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
  import {
    getFirestore,
    collection,
    addDoc,
    getDocs,
    getDoc,
    updateDoc,
    deleteDoc,
    doc
  } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBdPuebdQh5m7GoPfUyG-dtL0eCbqE1BtE",
    authDomain: "blog-bd628.firebaseapp.com",
    projectId: "blog-bd628",
    storageBucket: "blog-bd628.firebasestorage.app",
    messagingSenderId: "548493041269",
    appId: "1:548493041269:web:07460e97568e656a57623c",
    measurementId: "G-RCBHBBJWJD"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getFirestore(app);

  // Attach Firestore & helpers to global scope
  window.firebaseDB = db;
  window.firebaseRefs = {
    collection,
    addDoc,
    getDocs,
    getDoc,
    updateDoc,
    deleteDoc,
    doc
  };
</script>

</body>
</html>
